{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "bosun config",
  "type": "object",
  "additionalProperties": true,
  "properties": {
    "$schema": { "type": "string" },
    "projectName": { "type": "string" },
    "mode": {
      "type": "string",
      "enum": ["virtengine", "generic"]
    },
    "orchestratorScript": { "type": "string" },
    "orchestratorArgs": { "type": "string" },
    "logDir": { "type": "string" },
    "logMaxSizeMb": {
      "type": "number",
      "description": "Max total log folder size in MB. 0 = unlimited.",
      "default": 500
    },
    "logCleanupIntervalMin": {
      "type": "number",
      "description": "How often to check log folder size (minutes). 0 = startup only.",
      "default": 30
    },
    "telegramVerbosity": {
      "type": "string",
      "enum": ["minimal", "summary", "detailed"],
      "description": "Notification verbosity: minimal (critical+error), summary (default), detailed (everything)",
      "default": "summary"
    },
    "watchPath": { "type": "string" },
    "watchEnabled": { "type": "boolean" },
    "echoLogs": { "type": "boolean" },
    "autoFixEnabled": { "type": "boolean" },
    "workflowFirst": {
      "type": "boolean",
      "default": false,
      "description": "When true, all modules start in WORKFLOW mode by default. The task executor lifecycle is fully delegated to workflow templates (workflowOwnsTaskLifecycle). Bosun acts as a thin shell around the workflow engine."
    },
    "workflowOwnsTaskLifecycle": {
      "type": "boolean",
      "default": false,
      "description": "Delegate task finalization and recovery to workflow automation instead of the legacy TaskExecutor. Automatically set to true when workflowFirst is enabled."
    },
    "interactiveShellEnabled": { "type": "boolean" },
    "shellEnabled": { "type": "boolean" },
    "codexEnabled": { "type": "boolean" },
    "primaryAgent": {
      "type": "string",
      "enum": [
        "codex-sdk",
        "copilot-sdk",
        "claude-sdk",
        "gemini-sdk",
        "opencode-sdk"
      ]
    },
    "telegramUiTunnel": {
      "type": "string",
      "enum": ["named", "quick", "auto", "cloudflared", "disabled"],
      "default": "named",
      "description": "Mini App tunnel mode. named is the default permanent hostname mode."
    },
    "telegramUiAllowQuickTunnelFallback": {
      "type": "boolean",
      "default": false,
      "description": "Allow quick trycloudflare fallback only when named tunnel startup fails."
    },
    "cloudflareTunnelName": {
      "type": "string",
      "description": "Named Cloudflare tunnel identifier."
    },
    "cloudflareTunnelCredentials": {
      "type": "string",
      "description": "Path to cloudflared tunnel credentials JSON."
    },
    "cloudflareBaseDomain": {
      "type": "string",
      "description": "Base domain used for deterministic per-user tunnel hostnames."
    },
    "cloudflareTunnelHostname": {
      "type": "string",
      "description": "Explicit tunnel hostname override."
    },
    "cloudflareUsernameHostnamePolicy": {
      "type": "string",
      "enum": ["per-user-fixed", "fixed"],
      "default": "per-user-fixed",
      "description": "Policy for deriving named tunnel hostname from workstation identity."
    },
    "cloudflareZoneId": {
      "type": "string",
      "description": "Cloudflare zone ID used for DNS orchestration."
    },
    "cloudflareApiToken": {
      "type": "string",
      "description": "Cloudflare API token scoped to Zone DNS edit."
    },
    "cloudflareDnsSyncEnabled": {
      "type": "boolean",
      "default": true,
      "description": "Enable Cloudflare DNS idempotent create/verify/update during named tunnel startup."
    },
    "cloudflareDnsMaxRetries": {
      "type": "number",
      "default": 3,
      "description": "Retry attempts for Cloudflare DNS API operations."
    },
    "cloudflareDnsRetryBaseMs": {
      "type": "number",
      "default": 750,
      "description": "Base backoff delay for Cloudflare DNS API retries."
    },
    "telegramUiFallbackAuthEnabled": {
      "type": "boolean",
      "default": true,
      "description": "Enable admin fallback PIN/password auth when Telegram/session auth is unavailable."
    },
    "telegramUiFallbackAuthRateLimitIpPerMin": {
      "type": "number",
      "default": 10,
      "description": "Per-IP fallback auth attempt rate limit per minute."
    },
    "telegramUiFallbackAuthRateLimitGlobalPerMin": {
      "type": "number",
      "default": 60,
      "description": "Global fallback auth attempt rate limit per minute."
    },
    "telegramUiFallbackAuthMaxFailures": {
      "type": "number",
      "default": 5,
      "description": "Failed fallback auth attempts before temporary lockout."
    },
    "telegramUiFallbackAuthLockoutMs": {
      "type": "number",
      "default": 600000,
      "description": "Temporary lockout duration in milliseconds after max fallback auth failures."
    },
    "telegramUiFallbackAuthRotateDays": {
      "type": "number",
      "default": 30,
      "description": "Target credential rotation interval for fallback auth."
    },
    "telegramUiFallbackAuthTransientCooldownMs": {
      "type": "number",
      "default": 5000,
      "description": "Cooldown when fallback auth backend has transient errors."
    },
    "voice": {
      "type": "object",
      "description": "Voice assistant configuration for real-time voice interaction",
      "additionalProperties": false,
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true,
          "description": "Enable voice assistant features"
        },
        "provider": {
          "type": "string",
          "enum": ["openai", "azure", "claude", "gemini", "fallback", "auto"],
          "default": "auto",
          "description": "Voice provider: openai/azure (Tier 1 realtime), claude/gemini (Tier 2 voice + provider vision), fallback (browser STT/TTS), auto (detect from env)"
        },
        "providers": {
          "type": "array",
          "description": "Ordered provider candidates for voice routing/failover. First match with credentials is used.",
          "items": {
            "anyOf": [
              {
                "type": "string",
                "enum": ["openai", "azure", "claude", "gemini", "fallback"]
              },
              {
                "type": "object",
                "additionalProperties": false,
                "properties": {
                  "provider": {
                    "type": "string",
                    "enum": ["openai", "azure", "claude", "gemini", "fallback"]
                  },
                  "model": { "type": "string" },
                  "visionModel": { "type": "string" },
                  "voiceId": {
                    "type": "string",
                    "enum": [
                      "alloy",
                      "ash",
                      "ballad",
                      "coral",
                      "echo",
                      "fable",
                      "onyx",
                      "nova",
                      "sage",
                      "shimmer",
                      "verse"
                    ]
                  },
                  "azureDeployment": { "type": "string" },
                  "endpointId": {
                    "type": "string",
                    "description": "ID of the voice endpoint to use for this provider slot"
                  }
                },
                "required": ["provider"]
              }
            ]
          }
        },
        "model": {
          "type": "string",
          "default": "gpt-4o-realtime-preview-2024-12-17",
          "description": "Realtime API model name"
        },
        "visionModel": {
          "type": "string",
          "default": "gpt-4.1-mini",
          "description": "Vision model used for live screen/camera frame analysis"
        },
        "openaiApiKey": {
          "type": "string",
          "description": "OpenAI API key for Realtime API (overrides OPENAI_API_KEY env)"
        },
        "openaiAccessToken": {
          "type": "string",
          "description": "OpenAI OAuth access token for voice (OAuth preferred over API key when present)"
        },
        "azureApiKey": {
          "type": "string",
          "description": "Azure OpenAI API key for Realtime API"
        },
        "azureAccessToken": {
          "type": "string",
          "description": "Azure OAuth/AAD access token for voice realtime"
        },
        "azureEndpoint": {
          "type": "string",
          "description": "Azure OpenAI endpoint URL"
        },
        "azureDeployment": {
          "type": "string",
          "default": "gpt-4o-realtime-preview",
          "description": "Azure OpenAI deployment name"
        },
        "claudeApiKey": {
          "type": "string",
          "description": "Anthropic API key for Claude voice/vision provider mode"
        },
        "claudeAccessToken": {
          "type": "string",
          "description": "Claude OAuth access token for voice provider mode"
        },
        "geminiApiKey": {
          "type": "string",
          "description": "Gemini API key for Gemini voice/vision provider mode"
        },
        "geminiAccessToken": {
          "type": "string",
          "description": "Gemini OAuth access token for voice provider mode"
        },
        "voiceId": {
          "type": "string",
          "enum": [
            "alloy",
            "ash",
            "ballad",
            "coral",
            "echo",
            "fable",
            "onyx",
            "nova",
            "sage",
            "shimmer",
            "verse"
          ],
          "default": "alloy",
          "description": "Voice ID for TTS output"
        },
        "turnDetection": {
          "type": "string",
          "enum": ["server_vad", "semantic_vad", "none"],
          "default": "server_vad",
          "description": "Turn detection mode for voice activity detection"
        },
        "instructions": {
          "type": "string",
          "description": "Custom system instructions for the voice assistant"
        },
        "fallbackMode": {
          "type": "string",
          "enum": ["browser", "disabled"],
          "default": "browser",
          "description": "Fallback when Realtime API unavailable: browser (Web Speech API) or disabled"
        },
        "failover": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true,
              "description": "Enable automatic realtime failover across configured voice providers"
            },
            "maxAttempts": {
              "type": "number",
              "default": 2,
              "description": "Maximum realtime provider attempts per voice session token request"
            }
          }
        },
        "voiceEndpoints": {
          "type": "array",
          "description": "Named realtime voice endpoints, each with its own credentials. Multiple endpoints enable automatic failover with context preservation.",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["provider"],
            "properties": {
              "id": {
                "type": "string",
                "description": "Unique identifier for this endpoint"
              },
              "name": {
                "type": "string",
                "description": "Friendly label for this endpoint"
              },
              "provider": {
                "type": "string",
                "enum": ["azure", "openai", "claude", "gemini"],
                "description": "Provider type"
              },
              "endpoint": {
                "type": "string",
                "description": "Azure OpenAI endpoint URL (required for azure)"
              },
              "deployment": {
                "type": "string",
                "description": "Azure deployment name (required for azure)"
              },
              "apiKey": {
                "type": "string",
                "description": "API key for this endpoint"
              },
              "model": {
                "type": "string",
                "description": "Model name (for openai provider)"
              },
              "voiceId": { "type": "string" },
              "visionModel": { "type": "string" },
              "role": {
                "type": "string",
                "enum": ["primary", "backup"],
                "default": "primary"
              },
              "weight": {
                "type": "number",
                "default": 100,
                "description": "Priority weight â€” higher = tried first"
              },
              "enabled": { "type": "boolean", "default": true }
            }
          }
        },
        "delegateExecutor": {
          "type": "string",
          "enum": [
            "codex-sdk",
            "copilot-sdk",
            "claude-sdk",
            "gemini-sdk",
            "opencode-sdk"
          ],
          "description": "Which executor to use for delegate_to_agent calls. Defaults to primaryAgent."
        }
      }
    },
    "vkSpawnEnabled": { "type": "boolean" },
    "kanban": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "backend": {
          "type": "string",
          "enum": ["internal", "vk", "github", "jira"]
        },
        "syncPolicy": {
          "type": "string",
          "enum": ["internal-primary", "bidirectional"],
          "default": "internal-primary"
        },
        "projectId": { "type": "string" },
        "github": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "project": {
              "type": "object",
              "additionalProperties": false,
              "description": "GitHub Projects v2 integration settings",
              "properties": {
                "mode": {
                  "type": "string",
                  "enum": ["issues", "kanban"],
                  "default": "issues",
                  "description": "Task source mode: 'issues' for repo issues only, 'kanban' for project board sync"
                },
                "owner": {
                  "type": "string",
                  "description": "GitHub org/user that owns the project board"
                },
                "number": {
                  "type": ["string", "number"],
                  "description": "GitHub project number"
                },
                "title": {
                  "type": "string",
                  "description": "Project title for auto-detection"
                },
                "autoSync": {
                  "type": "boolean",
                  "default": true,
                  "description": "Auto-sync task status to project board Status field"
                },
                "statusMapping": {
                  "type": "object",
                  "additionalProperties": false,
                  "description": "Map internal statuses to project board column names",
                  "properties": {
                    "todo": { "type": "string", "default": "Todo" },
                    "inprogress": {
                      "type": "string",
                      "default": "In Progress"
                    },
                    "inreview": { "type": "string", "default": "In Review" },
                    "done": { "type": "string", "default": "Done" },
                    "cancelled": { "type": "string", "default": "Cancelled" }
                  }
                },
                "webhook": {
                  "type": "object",
                  "additionalProperties": false,
                  "description": "GitHub project webhook settings for near-real-time sync triggers",
                  "properties": {
                    "path": {
                      "type": "string",
                      "description": "HTTP path exposed by ui-server for GitHub webhook deliveries"
                    },
                    "secret": {
                      "type": "string",
                      "description": "Shared secret used to validate X-Hub-Signature-256"
                    },
                    "requireSignature": {
                      "type": "boolean",
                      "description": "Require a valid webhook signature before accepting payloads"
                    }
                  }
                },
                "syncMonitoring": {
                  "type": "object",
                  "additionalProperties": false,
                  "description": "Monitoring and alert thresholds for project-sync failures and rate-limits",
                  "properties": {
                    "alertFailureThreshold": {
                      "type": "number",
                      "description": "Consecutive webhook/sync failures that trigger an alert",
                      "default": 3
                    },
                    "rateLimitAlertThreshold": {
                      "type": "number",
                      "description": "Rate-limit events counted before triggering an alert",
                      "default": 3
                    }
                  }
                }
              }
            }
          }
        },
        "jira": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "baseUrl": {
              "type": "string",
              "description": "Jira Cloud base URL (e.g. https://your-domain.atlassian.net)"
            },
            "email": {
              "type": "string",
              "description": "Jira account email used for API authentication"
            },
            "apiToken": {
              "type": "string",
              "description": "Jira API token used for Basic authentication"
            },
            "projectKey": {
              "type": "string",
              "description": "Default Jira project key used for list/create operations"
            },
            "issueType": {
              "type": "string",
              "default": "Task",
              "description": "Default Jira issue type for new tasks"
            },
            "statusMapping": {
              "type": "object",
              "additionalProperties": false,
              "description": "Map internal statuses to Jira workflow status names",
              "properties": {
                "todo": { "type": "string", "default": "To Do" },
                "inprogress": { "type": "string", "default": "In Progress" },
                "inreview": { "type": "string", "default": "In Review" },
                "done": { "type": "string", "default": "Done" },
                "cancelled": { "type": "string", "default": "Cancelled" }
              }
            },
            "labels": {
              "type": "object",
              "additionalProperties": false,
              "description": "Jira labels used to mark codex shared-state lifecycle",
              "properties": {
                "claimed": { "type": "string", "default": "codex:claimed" },
                "working": { "type": "string", "default": "codex:working" },
                "stale": { "type": "string", "default": "codex:stale" },
                "ignore": { "type": "string", "default": "codex:ignore" }
              }
            },
            "sharedStateFields": {
              "type": "object",
              "additionalProperties": false,
              "description": "Custom field IDs used to persist shared-state payload",
              "properties": {
                "ownerId": {
                  "type": "string",
                  "description": "Custom field ID for sharedState.ownerId"
                },
                "attemptToken": {
                  "type": "string",
                  "description": "Custom field ID for sharedState.attemptToken"
                },
                "attemptStarted": {
                  "type": "string",
                  "description": "Custom field ID for sharedState.attemptStarted (ISO timestamp)"
                },
                "heartbeat": {
                  "type": "string",
                  "description": "Custom field ID for sharedState.heartbeat (ISO timestamp)"
                },
                "retryCount": {
                  "type": "string",
                  "description": "Custom field ID for sharedState.retryCount"
                },
                "ignoreReason": {
                  "type": "string",
                  "description": "Optional custom field ID for ignore reason"
                }
              }
            }
          }
        }
      }
    },
    "plannerMode": {
      "type": "string",
      "enum": ["codex-sdk", "kanban", "disabled"]
    },
    "triggerSystem": {
      "type": "object",
      "additionalProperties": true,
      "properties": {
        "enabled": { "type": "boolean", "default": false },
        "templates": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": true,
            "properties": {
              "id": { "type": "string" },
              "name": { "type": "string" },
              "description": { "type": "string" },
              "enabled": { "type": "boolean", "default": false },
              "action": {
                "type": "string",
                "enum": ["task-planner", "create-task"]
              },
              "minIntervalMinutes": { "type": "number", "minimum": 1 },
              "trigger": {
                "type": "object",
                "additionalProperties": true,
                "properties": {
                  "anyOf": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "additionalProperties": true,
                      "properties": {
                        "kind": {
                          "type": "string",
                          "enum": ["metric", "interval"]
                        },
                        "metric": { "type": "string" },
                        "operator": {
                          "type": "string",
                          "enum": ["lt", "lte", "gt", "gte", "eq", "neq"]
                        },
                        "value": { "type": ["number", "string", "boolean"] },
                        "minutes": { "type": "number", "minimum": 1 }
                      }
                    }
                  }
                }
              },
              "config": {
                "type": "object",
                "additionalProperties": true,
                "properties": {
                  "plannerMode": {
                    "type": "string",
                    "enum": ["codex-sdk", "kanban", "disabled"]
                  },
                  "defaultTaskCount": { "type": "number", "minimum": 1 },
                  "title": { "type": "string" },
                  "description": { "type": "string" },
                  "priority": { "type": "string" },
                  "executor": { "type": "string" },
                  "model": { "type": "string" }
                }
              }
            }
          }
        },
        "defaults": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "executor": { "type": "string" },
            "model": { "type": "string" }
          }
        }
      }
    },
    "activeWorkspace": {
      "type": "string",
      "description": "ID of the currently active workspace"
    },
    "workspaces": {
      "type": "array",
      "description": "Multi-repo workspace definitions",
      "items": {
        "type": "object",
        "additionalProperties": true,
        "required": ["id", "name"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Unique workspace identifier (lowercase, alphanumeric, dashes)"
          },
          "name": {
            "type": "string",
            "description": "Human-readable workspace name"
          },
          "repos": {
            "type": "array",
            "description": "Repositories in this workspace",
            "items": {
              "type": "object",
              "additionalProperties": true,
              "required": ["name"],
              "properties": {
                "name": {
                  "type": "string",
                  "description": "Repository directory name"
                },
                "url": { "type": "string", "description": "Git clone URL" },
                "slug": {
                  "type": "string",
                  "description": "GitHub slug (org/repo)"
                },
                "primary": {
                  "type": "boolean",
                  "description": "Whether this is the primary repo"
                },
                "branch": {
                  "type": "string",
                  "description": "Default branch to track"
                }
              }
            }
          },
          "activeRepo": {
            "type": ["string", "null"],
            "description": "Currently active repository name within the workspace"
          },
          "createdAt": {
            "type": "string",
            "description": "ISO 8601 creation timestamp"
          }
        }
      }
    },
    "defaultRepository": { "type": "string" },
    "repositoryDefaults": { "$ref": "#/$defs/repositoryDefaults" },
    "repositories": {
      "oneOf": [
        {
          "type": "array",
          "items": { "$ref": "#/$defs/repository" }
        },
        {
          "type": "object",
          "additionalProperties": true,
          "properties": {
            "default": { "type": "string" },
            "defaults": { "$ref": "#/$defs/repositoryDefaults" },
            "items": {
              "type": "array",
              "items": { "$ref": "#/$defs/repository" }
            },
            "list": {
              "type": "array",
              "items": { "$ref": "#/$defs/repository" }
            }
          }
        }
      ]
    },
    "internalExecutor": {
      "type": "object",
      "additionalProperties": true,
      "properties": {
        "mode": {
          "type": "string",
          "enum": ["vk", "internal", "hybrid"]
        },
        "maxParallel": { "type": "number" },
        "baseBranchParallelLimit": { "type": "number" },
        "pollIntervalMs": { "type": "number" },
        "sdk": {
          "type": "string",
          "enum": ["auto", "codex", "copilot", "claude", "gemini", "opencode"]
        },
        "taskTimeoutMs": { "type": "number" },
        "maxRetries": { "type": "number" },
        "reviewAgentEnabled": { "type": "boolean" },
        "reviewMaxConcurrent": { "type": "number" },
        "reviewTimeoutMs": { "type": "number" },
        "stream": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "maxRetries": {
              "type": "number",
              "description": "Transient stream retry attempts per run"
            },
            "retryBaseMs": {
              "type": "number",
              "description": "Base stream retry delay in milliseconds"
            },
            "retryMaxMs": {
              "type": "number",
              "description": "Maximum stream retry delay in milliseconds"
            },
            "firstEventTimeoutMs": {
              "type": "number",
              "description": "Abort/retry if no stream events arrive within this timeout"
            },
            "maxItemsPerTurn": {
              "type": "number",
              "description": "Maximum completed stream items retained per turn"
            },
            "maxItemChars": {
              "type": "number",
              "description": "Maximum characters retained per string field in stored stream items"
            }
          }
        }
      }
    },
    "profiles": { "$ref": "#/$defs/profiles" },
    "envProfiles": { "$ref": "#/$defs/profiles" },
    "executors": {
      "type": "array",
      "items": { "$ref": "#/$defs/executor" }
    },
    "failover": { "$ref": "#/$defs/failover" },
    "distribution": {
      "type": "string",
      "enum": ["weighted", "round-robin", "primary-only"]
    },
    "agentPrompts": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "orchestrator": { "type": "string" },
        "planner": { "type": "string" },
        "monitorMonitor": { "type": "string" },
        "taskExecutor": { "type": "string" },
        "taskExecutorRetry": { "type": "string" },
        "taskExecutorContinueHasCommits": { "type": "string" },
        "taskExecutorContinueHasEdits": { "type": "string" },
        "taskExecutorContinueNoProgress": { "type": "string" },
        "reviewer": { "type": "string" },
        "conflictResolver": { "type": "string" },
        "sdkConflictResolver": { "type": "string" },
        "mergeStrategy": { "type": "string" },
        "mergeStrategyFix": { "type": "string" },
        "mergeStrategyReAttempt": { "type": "string" },
        "autofixFix": { "type": "string" },
        "autofixFallback": { "type": "string" },
        "autofixLoop": { "type": "string" },
        "monitorCrashFix": { "type": "string" },
        "monitorRestartLoopFix": { "type": "string" }
      }
    },
    "hookProfiles": { "$ref": "#/$defs/hookProfiles" },
    "agentHooks": { "$ref": "#/$defs/agentHooks" },
    "auth": {
      "type": "object",
      "description": "Authentication configuration for agent SDKs",
      "additionalProperties": false,
      "properties": {
        "copilot": {
          "type": "object",
          "properties": {
            "sources": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["env", "cli", "vscode", "interactive"]
              },
              "description": "Auth source priority: env (tokens), cli (gh auth), vscode (extension), interactive (prompt)"
            },
            "fallbackToInteractive": {
              "type": "boolean",
              "description": "Allow interactive login if all other sources fail"
            }
          }
        },
        "claude": {
          "type": "object",
          "properties": {
            "sources": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["env", "cli", "interactive"]
              },
              "description": "Auth source priority: env (API key), cli (config file), interactive (prompt)"
            },
            "fallbackToInteractive": {
              "type": "boolean",
              "description": "Allow interactive API key prompt if all other sources fail"
            }
          }
        },
        "codex": {
          "type": "object",
          "properties": {
            "sources": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["config", "env", "interactive"]
              },
              "description": "Auth source priority: config (config.toml), env (API key), interactive (prompt)"
            },
            "fallbackToInteractive": {
              "type": "boolean",
              "description": "Allow interactive configuration if all other sources fail"
            }
          }
        }
      }
    }
  },
  "$defs": {
    "executor": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "name": { "type": "string" },
        "executor": { "type": "string" },
        "variant": { "type": "string" },
        "models": {
          "type": "array",
          "items": { "type": "string" }
        },
        "weight": { "type": "number" },
        "role": { "type": "string" },
        "enabled": { "type": "boolean" }
      }
    },
    "failover": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "strategy": {
          "type": "string",
          "enum": ["next-in-line", "weighted-random", "round-robin"]
        },
        "maxRetries": { "type": "number" },
        "cooldownMinutes": { "type": "number" },
        "disableOnConsecutiveFailures": { "type": "number" }
      }
    },
    "repositoryDefaults": {
      "type": "object",
      "additionalProperties": true,
      "properties": {
        "path": { "type": "string" },
        "slug": { "type": "string" },
        "projectName": { "type": "string" },
        "orchestratorScript": { "type": "string" },
        "orchestratorArgs": { "type": "string" },
        "logDir": { "type": "string" },
        "watchPath": { "type": "string" },
        "profile": { "type": "string" },
        "envProfile": { "type": "string" },
        "mode": { "type": "string" }
      }
    },
    "repository": {
      "type": "object",
      "additionalProperties": true,
      "properties": {
        "name": { "type": "string" },
        "id": { "type": "string" },
        "aliases": {
          "type": "array",
          "items": { "type": "string" }
        },
        "path": { "type": "string" },
        "repoRoot": { "type": "string" },
        "slug": { "type": "string" },
        "repo": { "type": "string" },
        "repoUrlBase": { "type": "string" },
        "projectName": { "type": "string" },
        "primary": { "type": "boolean" },
        "orchestratorScript": { "type": "string" },
        "orchestratorArgs": { "type": "string" },
        "logDir": { "type": "string" },
        "watchPath": { "type": "string" },
        "profile": { "type": "string" },
        "envProfile": { "type": "string" },
        "mode": { "type": "string" },
        "cacheDir": { "type": "string" },
        "statusPath": { "type": "string" },
        "telegramPollLockPath": { "type": "string" }
      }
    },
    "profiles": {
      "type": "object",
      "additionalProperties": {
        "type": "object",
        "additionalProperties": true,
        "properties": {
          "description": { "type": "string" },
          "env": {
            "type": "object",
            "additionalProperties": { "type": "string" }
          },
          "envFile": { "type": "string" },
          "envOverride": { "type": "boolean" },
          "repository": { "type": "string" },
          "repo": { "type": "string" },
          "defaultRepository": { "type": "string" },
          "overrides": { "type": "object" },
          "config": { "type": "object" },
          "settings": { "type": "object" }
        }
      }
    },
    "hookProfiles": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "enabled": { "type": "boolean" },
        "profile": {
          "type": "string",
          "enum": ["strict", "balanced", "lightweight", "none"]
        },
        "targets": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["codex", "claude", "copilot"]
          }
        },
        "overwriteExisting": { "type": "boolean" }
      }
    },
    "agentHooks": {
      "type": "object",
      "description": "Hook definitions loaded by agent-hooks.mjs (event -> hook list).",
      "additionalProperties": true
    },
    "mcpServers": {
      "type": "object",
      "description": "MCP (Model Context Protocol) server management. Controls which MCP servers are available to agents.",
      "additionalProperties": false,
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true,
          "description": "Enable MCP server integration for agent launches"
        },
        "defaultServers": {
          "type": "array",
          "items": { "type": "string" },
          "description": "MCP server IDs attached to every agent launch by default (e.g. [\"context7\", \"microsoft-docs\"])"
        },
        "catalogOverrides": {
          "type": "object",
          "additionalProperties": {
            "type": "object",
            "description": "Per-server environment variable overrides",
            "additionalProperties": { "type": "string" }
          },
          "description": "Environment variable overrides keyed by MCP server ID"
        },
        "autoInstallDefaults": {
          "type": "boolean",
          "default": true,
          "description": "Automatically install defaultServers from catalog if not already installed"
        }
      }
    }
  }
}
